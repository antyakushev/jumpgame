

<style>
    * {
        margin: 0;
        padding: 0;
    }
    body {
        width: 100vw;
        overflow: hidden;
    }
    .world {
        height: 100vh;
        width: 200vw;
    }
    .background {
        height: 100vh;
        width: 200vw;
        opacity: 0.8;
        background-color: #e5e5f7;
        background-image: url("bg.png");
        background-size: 50%;
    }
    .stone {
        width: 100px;
        display: none;
    }
    .hero {
        font-size: 72px;
        z-index: 1;
    }
    .object {
        position: absolute; 
        bottom: 0;
    }
    .overlay {
        position: absolute;
        height: 100vh;
        width: 100vw;
        display: flex;
        align-items: center;
        justify-content: center;
        display: none;
        flex-direction: column;
        font-size: 72px;
        color: orange;
        background-color: rgba(255,255,255,0.8);
    }
    .overlay.visible {
        display: flex;
    }
    .restart {
        display: block;
        margin: 20px;
        padding: 40px;
        background-color: orange;
        color: white;
        border: none;
        border-radius: 100%;
        font-size: 36px;
        cursor: pointer;
    }
    .points {
        position: absolute;
        top: 0;
        right: 0;
    }
</style>

<div class="hero object" id="hero">
    ðŸ‘»
</div>
<div class="world object" id="world">
    <div class="background object" id="background"></div>
    <img class="stone object" id="stone" src="stone.png"/>
</div>
<div class="points" id="points"></div>
<div class="overlay" id="overlay">
    Ð‘Ð°Ð±Ð°Ñ…!
    <button class="restart" id="restart_button">ÐŸÐ¾Ð¿Ñ€Ð¾Ð±Ð¾Ð²Ð°Ñ‚ÑŒ ÐµÑ‰Ñ‘</button>
</div>

<script>
    let hero = document.getElementById('hero');
    let stone = document.getElementById('stone');
    let world = document.getElementById('world');
    let overlay = document.getElementById('overlay');
    let background = document.getElementById('background');
    let restartButton = document.getElementById('restart_button');
    let pointsElement = document.getElementById('points');
    bottom = 0;
    speed = 0;
    frame = 0;
    worldSpeed = 5;
    worldMoved = 0;
    points = -1;
    stopped = false;

    let pause = () => {
        stopped = true;
    }

    let reset = () => { // ÑÐ±Ñ€Ð°ÑÑ‹Ð²Ð°ÐµÑ‚ ÑÐ¾ÑÑ‚Ð¾ÑÐ½Ð¸Ðµ
        bottom = 0;
        speed = 0;
        frame = 0;
        worldSpeed = 5;
        worldMoved = 0;
        points = -1;
        stopped = false;
    }

    let intersects = (r1, r2) => {
        let result = (r2.x < r1.x + r1.width && r2.x + r2.width > r1.x) && (r1.y < r2.y + r2.height && r1.y + r1.width > r2.y); // Ð¿Ñ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ Ð¿ÐµÑ€ÐµÑÐµÐºÐ°ÑŽÑ‚ÑÑ Ð»Ð¸ ÐºÐ¾Ð¾Ñ€Ð´Ð¸Ð½Ð°Ñ‚Ñ‹
        return result; // Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‰Ð°ÐµÐ¼ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚
    }

    let isBehind = (r) => {
        if ((r.x + r.width) < 0) {
            console.log((r.x + r.width) < 0, r.x + r.width, r.x, r.width);
        }
        return (r.x + r.width) < 0;
    }

    let newStone = () => {
        points = points + 1;
        stone.style.display = 'block'
        stone.style.bottom = document.body.offsetHeight * Math.random() / 3;
        stone.style.left = worldMoved + document.body.offsetWidth;
    }    

    let showOverlay = () => {
        overlay.classList.add('visible'); // Ð¿Ð¾ÐºÐ°Ð·Ñ‹Ð²Ð°ÐµÐ¼ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ Ð¾ Ð¿Ñ€Ð¾Ð¸Ð³Ñ‹ÑˆÐµ
    }

    let restart = () => {
        reset(); // ÑÐ±Ñ€Ð°ÑÑ‹Ð²Ð°ÐµÐ¼ ÑÐ¾ÑÑ‚Ð¾ÑÐ½Ð¸Ðµ
        overlay.classList.remove('visible'); // ÑƒÐ±Ð¸Ñ€Ð°ÐµÐ¼ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ Ð¾ Ð¿Ñ€Ð¾Ð¸Ð³Ñ‹ÑˆÐµ
        loop(); // Ð·Ð°Ð¿ÑƒÑÑ‚Ð¸Ð¼ Ð¸Ð³Ñ€Ð¾Ð²Ð¾Ð¹ Ñ†Ð¸ÐºÐ»
        newStone();
    }

    renderFrame = () => {
        frame = frame + 1; // Ð¿Ñ€Ð¸Ð±Ð°Ð²Ð¸Ð¼ ÑÑ‡ÐµÑ‚Ñ‡Ð¸Ðº ÐºÐ°Ð´Ñ€Ð¾Ð²
        worldMoved = worldMoved + worldSpeed; 
        pointsElement.innerText = `ÐžÑ‡ÐºÐ¸: ${points}`;
        world.style.transform = `translateX(${-worldMoved}px)`;
        background.style.transform = `translateX(${worldMoved - (worldMoved + worldSpeed) % document.body.offsetWidth}px)`;
        if (bottom > 0) {
            speed = speed - 1;
        }
        bottom = bottom + speed;
        if (bottom <= 0 && speed <= 0) {
            speed = 0;
            bottom = 0;
        }
        hero.style.bottom = bottom;
        let heroRect = hero.getBoundingClientRect();
        let stoneRect= stone.getBoundingClientRect();
        if (isBehind(stoneRect)) {
            setTimeout(newStone, 0)
        }  
        if (intersects(heroRect, stoneRect)) {
            pause();
            showOverlay();
        }
    }

    loop = () => {
        requestAnimationFrame(() => {
            renderFrame(); // Ð¿ÐµÑ€ÐµÑÑ‡Ð¸Ñ‚Ð°ÐµÐ¼ ÐºÐ°Ð´Ñ€
            if (!stopped) { // ÐµÑÐ»Ð¸ Ð¸Ð³Ñ€Ð° Ð½Ðµ Ð¾ÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½Ð°
                loop(); // Ð¿ÐµÑ€ÐµÐ¹Ð´Ñ‘Ð¼ Ðº ÑÐ»ÐµÐ´ÑƒÑŽÑ‰ÐµÐ¼Ñƒ ÐºÐ°Ð´Ñ€Ñƒ
            }
        })
    }

    document.addEventListener('keypress', (evt) => { // ÐŸÑ€Ð¸ Ð½Ð°Ð¶Ð°Ñ‚Ð¸Ð¸ Ð½Ð° ÐºÐ½Ð¾Ð¿ÐºÑƒ
        if (evt.code === 'Space') { // ÐµÑÐ»Ð¸ Ð½Ð°Ð¶Ð°Ð»Ð¸ Ð¿Ñ€Ð¾Ð±ÐµÐ»
            if (bottom === 0) {
                speed = speed + 30; // ÑƒÐ²ÐµÐ»Ð¸Ñ‡Ð¸Ð¼ ÑÐºÐ¾Ñ€Ð¾ÑÑ‚ÑŒ
            }
        }
    })

    restartButton.addEventListener('click', (evt) => {
        restart();
    })

    restart(); 

    
    
</script>